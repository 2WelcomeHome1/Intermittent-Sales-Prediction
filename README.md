# Прогнозирование продаж (Intermittent)

**Данные**
Имеются данные о продажах двух товарных номенклатур интернет-магазина. Каждая строчка в файле содержит дату и количество номенклатур, купленных в этот день. Обе номенклатуры резко отличаются частотой реализиции.

**Задача:** Требуется найти модель, способную прогнозировать обе номенклатуры с приемлемой точностью на 30-40 дней вперёд. 

**Метрики:** Клиент оценивает качество прогнозирования по метрике buying score. Перезакуп buying score > 1 более вреден, чем недозакуп buying score < 1.  

Решение поставленной задачи выполнялось в три основных этапа:
1. Анализ исходных данных.
2. Анализ существующих методов решения. Поиск наиболее оптимального и эффективного
3. Выполнение поставленной задачи, используя выбранный метод.


## Этап 1. Анализ исходных данных

Первым этапом был проведен анализ исходных данных. В результате анализа было выявлено, что:
1. Исходные данные в таблице расположены не в хронологическом порядке. Было принято решение отсортировать исходный ряд в хронологическом порядке.
2. Некоторые даты в списке повторялись дважды (18 строк). При изучении повторяющихся данных можно было предположить два варианта:

     а) Это случайные дубликаты, которые необходимо удалить;

     б) В данный день было сделано несколько продаж, но в разное время, а из-за возможной специфики БД эти продажи расположились на разных строках.

      В результате было принято решение опираться на вариант _б_. Поэтому была создана дополнительная функция _"_delete_duplicte" _. Данная функция автоматически проверяет набор данных и извлекает дублирующиеся строки, затем суммирует их значения, и удалет лишиние данные. 
3. В представленных данных присутствуют относительно большие хронологические разрывы. Это говорит о том, что в пропущенные дни не было продаж. Использование этих дополнительных вводных дает модели и человеку больше полезной информации при выполнении задачи прогнозирования спроса\числа продаж. Было принято решение добавить в набор данных пропущенные даты и присвоить значение продаж, равное нулю.

В результате применения всех преобразований было выявлено, что данная задача представляет собой ничто иное, как прогнозирование прерывистого и "комковатого" временного ряда (Intermittent and Lumpy Time Series Forecasting).

## Этап 2. Анализ методов
В первую очередь с поомощью библиотеки statsforecast компании [Nixtla] (https://nixtla.github.io/statsforecast/) были проверены основные [алгоритмы]( https://nixtla.github.io/statsforecast/docs/tutorials/intermittentdata.html) , использующиеся для решения подобной задачи:

✅ ADIDA				✅ CrostonClassic			✅ CrostonOptimized			✅ CrostonSBA			✅ IMAPA		✅ TSB

Анализ данных алгоритмов показал, что несмотря на высокую эффективность, данные алгоритмы не подходят для финального решения данной задачи, так как способны выполнять только точечные предсказания, а в нашем случае необходимо  выполнять предсказания на 30-40 дней вперерд

Вторым этапом проверялись динамические модели, такие как:

✅ Модель Хольта-Винтерса ✅Модель SARIMA ✅Модель fbProphet

Полученный результат так же не показал достаточной точности. 

Третьим этапом было принято решение провести анализ алгоритмов машинного обучения. В результате анализа [статьи] (https://d-nb.info/1251326714/34) было выявлено, что использование алгоритмов машинного обучения, таких как ✅ Random Forest ✅XGBoost ✅Auto-SVR может принести положительный эффект. однако есть более точные решения.

Заключительным этапом собирались и проверялись различные модели и комбинации  моделей нейронных сетей, таких как: ✅ LSTM, ✅ SimpleRNN. В результате анализа было выявлено, что наиболее эффективным решением данной задачи является построение модели нейронной сети.

## Этап 3. Выполнение поставленной задачи

Для наглядности выполнения задачи был использован формат представления данных в виде .ipynb Jupyter ноутбука. Таким образом можно более наглядно продемонстрировать все этапы выполнения поставленной задачи. 

Первым этапом выполняется отчистка и подготовка данных

Вторым этапом была разработана и обучена модель ИИ. Подбор числа слоев, видов слоев и гиперпараметров в основном выполнялся эмперическим путем на основе имеющегося опыта.

Третьим этапом выполнялось тестирование разработанной модели на тестовом наборе данных, а так же на данных со второго артикула.

Результаты работы представлены в .ipynb Jupyter ноутбуке. 



## Этап X. Альтернативное решение данной

Задача прогнозирования прерывистого временного ряда является достаточно трудозатратной, и до сих пор идеально не решенной. Альтернативой ранее предложеному методу служит способ, при котором мы заранее группируем имеющиеся данные в большие временные промежутки (например, недели, месяца или кварталы). Подобное преобразование позволит исключить ненужные прерывания во временных рядах, что в значительной степени упростит задачу. В конечном итоге спрогнозированный результат мы распределяем на то количнество дней, масштаб которого мы использовали для преобразования временного ряда (месяц - делим на 30 дней, неделя - 7 дней, квартал - 90 и так далее).

Дополнительно к основному решению приложены два ноутбука, отображающие подобно решение при масштабировании по месяцам и неделям соотвественно.
